using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace homeWork6_7
{
    class Program
    {
        private const string StartProgramm = "1";
        private const string ShowAllTrain = "2";
        private const string ExitProgramm = "3";
        static void Main(string[] args)
        {
            Console.WriteLine("Это программа создает маршрут для движения поезда,\nпродает билеты, оптимально заполняет вагоны и отправляет состав в путь!");
            Console.WriteLine();
            bool isWork = true;
            Station station = new Station();

            while (isWork)
            {
                Console.WriteLine("Меню программы:");
                Console.WriteLine("Подготовить поезд к отправке - " + StartProgramm + "\nПоказать все поезда - " + ShowAllTrain + "\nВыход - " + ExitProgramm);
                string message = Console.ReadLine();

                switch (message)
                {
                    case StartProgramm:
                        station.Work();
                        break;

                    case ShowAllTrain:
                        station.ShowDatabase();
                        break;

                    case ExitProgramm:
                        isWork = false;
                        break;

                    default:
                        Console.WriteLine("Не верный ввод. Такой команды нет!");
                        break;
                }
            }
        }
    }

    class Direction
    {
        public string PointA { get; private set; }
        public string PointB { get; private set; }

        public Direction(string pointA, string pointB)
        {
            PointA = pointA;
            PointB = pointB;
        }

        public void ShowInfo()
        {
            Console.WriteLine("Станция отправления - " + PointA + ", станция прибытия - " + PointB + " - отправлен");
        }
    }

    class Passenger
    {
        private Random _random = new Random();
        private int _people;

        public int GetPeople()
        {
            int minCount = 150;
            int maxCount = 350;
            int countPeople = _random.Next(minCount, maxCount);
            _people = countPeople;
            return _people;
        }
    }

    class Station
    {
        private List<Direction> _direction = new List<Direction>();
        private Train _train = new Train();
        private Passenger _passenger = new Passenger();  

        public void Work()
        {
            if (_train.TryCreationDirection())
            {
                SellTickets();
                FillDatabase();

                if (_train.Create())
                {
                    Console.WriteLine("Поезд отправляется в путь! Счастливого пути!");
                    Console.WriteLine("Для продолжения работы нажмите любую клавишу");
                    Console.ReadKey();
                    Console.Clear();
                }
            }
        }

        public void ShowDatabase()
        {
            if (_direction.Count > 0)
            {
                for (int i = 0; i < _direction.Count; i++)
                {
                    Console.Write(i + 1 + " ");
                    _direction[i].ShowInfo();
                }
            }
            else
            {
                Console.WriteLine("База данных пока пуста! Отправьте поезд!");
            }
            Console.WriteLine();
            Console.WriteLine("Для продолжения работы нажмите любую клавишу");
            Console.ReadKey();
            Console.Clear();
        }

        private int SellTickets()
        {
            int countTickets = _passenger.GetPeople();
            Console.WriteLine("Станция отправления - " + _train.StationA + ", станция прибытия - " + _train.StationB + " - в продаже");
            Console.WriteLine();
            Console.WriteLine("Было продано - " + countTickets + " билетов");
            return countTickets;
        }

        private void FillDatabase()
        {
            Direction direction = new Direction(_train.StationA, _train.StationB);
            _direction.Add(direction);
            Console.WriteLine();
        }
    }

    class Train
    {
        private Wagon _wagon = new Wagon();
        public string StationA { get; private set; }
        public string StationB { get; private set; }

        public bool TryCreationDirection()
        {
            string pointA;
            string pointB;
            Console.WriteLine("Создание нового направления! Введите станцию отправления:");
            pointA = Console.ReadLine();
            Console.WriteLine("Введите станцию конца маршрута:");
            pointB = Console.ReadLine();

            if (pointA == null || pointB == null)
            {
                Console.WriteLine("Введены не корректные данные!");
                return false;
            }
            else
            {
                StationA = pointA;
                StationB = pointB;
                Console.WriteLine("Направление создано успешно");
                return true;
            }
        }

        public bool Create()
        {
            if (_wagon.TrySetCapacityWagons() == true)
            {
                if (_wagon.TryCreateWagons() == true)
                {
                    Console.WriteLine("\nСостав сформирован! Вместимость вагонов - " + _wagon.CapacityWagons + ", количество вагонов - " + _wagon.CountWagons);
                    return true;
                }
            }
            return false;
        }
    }

    class Wagon
    {
        private Passenger _passenger = new Passenger();
        private int _minimumCountWagons = 5;
        private int _maximumCountWagons = 20;
        private int _minimumCapacity = 20;
        private int _maximumCapacity = 36;
        public int CountWagons { get; private set; }
        public int CapacityWagons { get; private set; }

        public bool TrySetCapacityWagons()
        {
            Console.WriteLine("\nКонфигуратор вместимости вагона:");
            Console.WriteLine("Вы можете сами задать вместимость вагонов.");
            Console.WriteLine("Минимальная вместимость вагона - " + _minimumCapacity + ", максимальная - " + _maximumCapacity);
            bool isWork = true;

            while (isWork)
            {
                Console.WriteLine("Введите желаемую вместимость:");
                int userCapacity = UserUtilities.ReadPositiveInt();

                if (userCapacity < _minimumCapacity || userCapacity > _maximumCapacity)
                {
                    Console.WriteLine("Вы ввели не допустимое кол - во мест!");
                }
                else
                {
                    Console.WriteLine("Конфигурация вместимости создана!");
                    CapacityWagons = userCapacity;
                    return true; ;
                }
            }
            return false;
        }

        public bool TryCreateWagons()
        {
            Console.WriteLine("\nКонфигуратор количества вагонов:");
            Console.WriteLine("Минимальное кол - во вагонов - " + _minimumCountWagons + ", максимальное - " + _maximumCountWagons);
            int countPeople = _passenger.GetPeople();
            int countWagons = countPeople / CapacityWagons;

            if (countPeople % CapacityWagons > 0)
            {
                countWagons++;
            }

            if (countWagons < _minimumCountWagons || countWagons > _maximumCountWagons)
            {
                Console.WriteLine("Не возможно создать такое кол - во  вагонов! Слишком мало пассажиров!");
                return false;
            }
            else
            {
                Console.WriteLine("В " + countWagons + " вагонов поместятся все пассажиры.");
                CountWagons = countWagons;
                return true;
            }
        }
    }

    static class UserUtilities
    {
        public static int ReadPositiveInt()
        {
            int resalt = 0;
            bool isWork = true;

            while (isWork)
            {
                string userInput = Console.ReadLine();
                bool success = int.TryParse(userInput, out int inputNumber);

                if (inputNumber >= 0 && success == true)
                {
                    resalt = inputNumber;
                    isWork = false;
                }
                else
                {
                    Console.WriteLine("Не корректный ввод. Введите положительное число!");
                }
            }
            return resalt;
        }
    }
}
